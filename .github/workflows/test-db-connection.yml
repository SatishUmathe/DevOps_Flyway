name: Test Database Connection (.NET Console App)

on:
  workflow_dispatch:  # allows manual run from GitHub Actions tab

jobs:
  test-db:
    runs-on: ubuntu-latest

    steps:
      # 1️ Checkout your repo
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2️ Setup .NET SDK
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'   # or 7.0.x depending on your project

      # 3️ Restore dependencies
      - name: Restore Dependencies
        working-directory: DevOps_FlyWay
        run: dotnet restore

      # 4️ Build your project
      - name: Build
        working-directory: DevOps_FlyWay
        run: dotnet build --configuration Release --no-restore

      # 5️ Run your console app
      - name: Run Console App to Test DB Connection
        working-directory: DevOps_FlyWay
        env:
          DB_CONNECTION_STRING: ${{ secrets.DB_CONNECTION_STRING }}
        run: dotnet run --configuration Release
